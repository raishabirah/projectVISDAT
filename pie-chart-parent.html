<!DOCTYPE html>
<html lang="en"></html>
<head>
  <meta charset="utf-8">
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <!-- Color scale -->
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>



<body>

<!-- Add 5 buttons -->
<div class="ms-4 btn-group" >
    <button class="btn btn-secondary" onclick="update(bachelor)">Bachelor's Degree</button>
    <button class="btn btn-secondary" onclick="update(master)">Master's Degree</button>
    <button class="btn btn-secondary" onclick="update(some_college)">Some Collage</button>
    <button class="btn btn-secondary" onclick="update(associate)">Associate's Degree</button>
    <button class="btn btn-secondary" onclick="update(high_school)">High School</button>
    <button class="btn btn-secondary" onclick="update(some_high_school)">Some High School</button>

</div>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>
  // set the dimensions and margins of the graph
  var width = 450
      height = 450
      margin = 40
  
  // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
  var radius = Math.min(width, height) / 2 - margin
  
  // append the svg object to the div called 'my_dataviz'
  var svg = d3.select("#my_dataviz")
    .append("svg")
      .attr("width", width)
      .attr("height", height)
    .append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
  
  // create 2 data_set
  var bachelor = {A: 13, B: 18, C:35, D:31, F:21}
  var some_college = {A: 11, B: 35, C:62, D:63, F:55}
  var master = {A: 6, B: 14, C:16, D:13, F:10}
  var associate = {A: 16, B: 35, C:59, D:53, F:59}
  var high_school = {A: 2, B: 18, C:45, D:55, F:76}
  var some_high_school = {A: 4, B: 26, C:44, D:41, F:64}

  // set the color scale
  var color = d3.scaleOrdinal()
    .domain(["A", "B", "C", "D", "F"])
    .range(d3.schemeSet2);
  
  // A function that create / update the plot for a given variable:
  function update(data) {
  
    // Compute the position of each group on the pie:
    var pie = d3.pie()
      .value(function(d) {return d.value; })
      .sort(function(a, b) { console.log(a) ; return d3.ascending(a.key, b.key);} ) // This make sure that group order remains the same in the pie chart
    var data_ready = pie(d3.entries(data))
  
    // map to data
    var u = svg.selectAll("path")
      .data(data_ready)
  
    // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
    u
      .enter()
      .append('path')
      .merge(u)
      .transition()
      .duration(1000)
      .attr('d', d3.arc()
        .innerRadius(0)
        .outerRadius(radius)
      )
      .attr('fill', function(d){ return(color(d.data.key)) })
      .attr("stroke", "white")
      .style("stroke-width", "2px")
      .style("opacity", 1)
  
    // remove the group that is not present anymore
    u
      .exit()
      .remove()

    // Create labels for each slice
    var labels = svg.selectAll("text")
      .data(data_ready);

    labels.enter()
      .append("text")
      .merge(labels)
      .transition()
      .duration(1000)
      .text(function(d) { 
        var percent = ((d.data.value / d3.sum(Object.values(data))) * 100).toFixed(2);
        return percent + "%"; 
    })
      .attr("transform", function(d) {
    var pos = d3.arc()
        .innerRadius(0)
        .outerRadius(radius)
        .centroid(d);
    return "translate(" + pos + ")";
    })
    .style("text-anchor", "middle")
    .style("font-size", 14);

    labels
      .exit()
      .remove();

    // Remove existing legend
    svg.selectAll(".legend").remove();

      // Create legend
    var legend = svg.selectAll(".legend")
    .data(color.domain())
    .enter()
    .append("g")
    .attr("class", "legend")
    .attr("transform", function(d, i) { return "translate(" + (-width/3 + i*70) + "," + (height/2 - margin+ 10) + ")"; });

    // Add colored squares to legend
    legend.append("rect")
    .attr("x", 0)
    .attr("width", 18)
    .attr("height", 18)
    .style("fill", color);

    // Add text to legend
    legend.append("text")
    .attr("x", 24)
    .attr("y", 9)
    .attr("dy", ".35em")
    .text(function(d) { return d; });
  
  }
  
  // Initialize the plot with the first dataset
  update(bachelor)
  </script>
  </div>
</body>
</html>